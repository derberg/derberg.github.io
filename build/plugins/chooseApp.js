!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.chooseAppPlugin=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports=function(){"use strict";function init(){USER_LOGIN=lscache.get("login"),IDTOKEN=lscache.get("id_token"),IDTOKEN&&(checkTokenCached("noTenantToken","hybris.no_tenant",function(){$("#existingProject").show()}),window.addEventListener("message",receiveMessage,!1),$("#pickExistingProjects").click(function(){checkTokenCached("noTenantToken","hybris.no_tenant",function(){USER_LOGIN=lscache.get("login"),IDTOKEN=lscache.get("id_token"),$(".alert-danger").remove(),$("#existingProjectLoader").fadeIn(300),SHOULD_CALL_FOR_NOTENANT_FOR_YODA=!0,getTenants()})}),$("#injectHandler").click(injectCredentials))}function receiveMessage(event){var data=event.data;data&&data.failed&&onGetTokenError(data.scope),data&&data.noTenantToken&&($("#oauthFrame").remove(),$("#existingProject").show(),2===SHOULD_CALL_FOR_NOTENANT_FOR_PROJECT?getTenants():SHOULD_CALL_FOR_NOTENANT_FOR_PROJECT++,SHOULD_CALL_FOR_NOTENANT_FOR_YODA&&getCredentials()),data&&data.tenantToken&&($("#oauthFrame").remove(),getApps(data))}function listTenants(tenants){var $selectContainer=$("#selectTenants"),$select=$("#projects");if(!tenants||!tenants.length)return $("#appCredentials").slideUp(300),showErrorExistingProjectHeader("You have no projects yet."),$selectContainer.hide();$selectContainer.show(),sendMessageResizeNeeded();var projects=[];tenants.forEach(function(tenant){projects.push({id:tenant.id,text:tenant.name})}),setUpSelect($select,projects,"Select a Project"),$select.change(function(){$("#existingProjectLoader").fadeIn(300)}),PROJ_FIRST_FUNC_CALL||(PROJ_FIRST_FUNC_CALL=!0,$select.change(checkTenantApps)),$("#existingProjectLoader").fadeOut(300),$("#pickExistingProjects").hide(),$("#existingProjects").slideDown(300)}function checkTokenCached(cacheKey,scope,next){lscache.get(cacheKey)?next():getToken(scope)}function getTenants(){makeAjaxCall(ACCOUNT_SERVICE_URL+"projects?member="+USER_LOGIN,lscache.get("noTenantToken"),function(err,data){listTenants(data)})}function checkTenantApps(){$(".alert-danger").remove();var tenant=$(this).val();tenant&&(APP_DATA.projectId=tenant,getToken("hybris.tenant="+APP_DATA.projectId+"+hybris.account_view"))}function getToken(scope){var serviceFrame=document.createElement("iframe");serviceFrame.setAttribute("id","oauthFrame"),serviceFrame.setAttribute("style","display: none; position:absolute; top:0px; left:0px;"),serviceFrame.src=OAUTH_SERVICE_URL+"/authorize?response_type=token&client_id="+CLIENT_ID+"&redirect_uri="+REDIR_URL+"&id_token_hint="+IDTOKEN+"&scope="+scope,document.body.appendChild(serviceFrame),serviceFrame.addEventListener("load",function(){var hash,frameContent,frame=document.getElementById("oauthFrame");try{frameContent=frame.contentDocument,hash=frameContent.location.hash,hash||window.parent.postMessage({failed:!0,scope:scope},"*")}catch(e){onGetTokenError(scope)}},!1)}function getApps(){SHOULD_CALL_FOR_NOTENANT_FOR_YODA=!0,$("#existingProjectLoader").fadeIn(300),makeAjaxCall(ACCOUNT_SERVICE_URL+"projects/"+APP_DATA.projectId+"/apps",lscache.get("tenantToken"),function(err,data){var $selectContainer=$("#selectApps"),$select=$("#applications");if(!data||!data.length)return $("#appCredentials").slideUp(300),showErrorExistingProjectHeader("You have no application yet."),$("#injectHandler").slideUp(300),$selectContainer.slideUp(300);sendMessageResizeNeeded(),$("#appCredentials").slideUp(300),$("#injectHandler").slideUp(300);var applications=[];data.forEach(function(app){applications.push({id:[app.id,app.clientId,app.clientSecret],text:app.displayName})}),$select.select2("val",""),setUpSelect($select,applications,"Select an Application"),data&&data.length&&$selectContainer.slideDown(300),APP_FIRST_FUNC_CALL||(APP_FIRST_FUNC_CALL=!0,$select.change(function(){$("#existingProjectLoader").fadeIn(300),$(".alert-danger").remove(),checkTokenCached("noTenantToken","hybris.no_tenant",getCredentials)}),$select.on("select2:open",function(){$(".select2-drop").each(function(){$(this).hasClass("select2-drop--secondary")||$(this).addClass("select2-drop--secondary")})})),$("#existingProjectLoader").fadeOut(300)})}function getCredentials(){$.ajax({url:MARKETPLACE_SERVICE_URL+"/packages/available?project=true",method:"GET",retryCall:!0,headers:{Authorization:"Bearer "+lscache.get("tenantToken")},success:getTokenWithScopes,error:retryCall})}function injectCredentials(){try{window.sessionStorage.setItem("credentials",JSON.stringify(APP_DATA)),$("#iframeNotebook").contents().find("#credentialsButton").trigger("click")}catch(err){return}}function getTokenWithScopes(response){var scopes=obtainScopes(response)||[];setSelectedAppData(),$.ajax({url:OAUTH_SERVICE_URL+"/token",method:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",retryCall:!0,data:{client_id:APP_DATA.clientId,client_secret:APP_DATA.clientSecret,grant_type:"client_credentials",scope:scopes.join(" ")},success:showCredentialsWithToken,error:retryCall})}function showCredentialsWithToken(response){APP_DATA.token=response.access_token,$("#existingProjectLoader").fadeOut(300),$("#injectHandler").slideUp(300),$("#appCredentials").slideUp(300),$("#appCredentials code").html('<span class="hljs-tag"><strong>ClientId:</strong></span> '+APP_DATA.clientId+'<br><span class="hljs-tag"><strong>ClientSecret:</strong></span> '+APP_DATA.clientSecret+'<br><span class="hljs-tag"><strong>AppId:</strong></span> '+APP_DATA.appId+'<br><span class="hljs-tag"><strong>ProjectId:</strong></span> '+APP_DATA.projectId+'<br><span class="hljs-tag"><strong>Token:</strong></span> '+APP_DATA.token),$("#appCredentials").slideDown(300,sendMessageResizeNeeded),$("#injectHandler").slideDown(300)}function setSelectedAppData(){var selectOption=$("#applications").val().split(",");APP_DATA.appId=selectOption[0],APP_DATA.clientId=selectOption[1],APP_DATA.clientSecret=selectOption[2]}function showErrorExistingProjectHeader(msg){$("#existingProjectLoader").fadeOut(300),$("#existingProjectHeader").after('<div style="display:none;" class="alert alert-danger alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>'+msg+"</div>").next().slideDown(300)}function onGetTokenError(scope){$("#existingProjectLoader").fadeOut(300),showErrorExistingProjectHeader("Your access token expired and we failed to renew it, please try again."),$("#projects").select2("val","")}function sendMessageResizeNeeded(){window.dispatchEvent(RESIZE_EVENT)}function setUpSelect(el,data,placeholder){el.select2({data:data,placeholder:placeholder}),$(".select2-container").each(function(){$(this).hasClass("select2-container--secondary")||$(this).addClass("select2-container--secondary")}),$(".select2-drop").each(function(){$(this).hasClass("select2-drop--secondary")||$(this).addClass("select2-drop--secondary")})}function makeAjaxCall(url,token,cb){$.ajax({url:url,headers:{Authorization:"Bearer "+token,"Content-Type":"application/json"},retryCall:!0,success:function(data){cb(null,data)},fail:retryCall,error:retryCall})}function retryCall(){return this.retryCall?(this.retryCall=!1,$.ajax(this)):($("#existingProjectLoader").fadeOut(300),showErrorExistingProjectHeader("Error, please try again."),void $("#applications").select2("val",""))}function obtainScopes(packages){var requiredScopes=[];return packages?(packages.forEach(function(singlePackage){singlePackage&&singlePackage.mixins&&singlePackage.mixins["package"]&&singlePackage.mixins["package"].requiredScopes&&singlePackage.mixins["package"].requiredScopes.length&&(requiredScopes=requiredScopes.concat(singlePackage.mixins["package"].requiredScopes))}),$.unique(requiredScopes)):requiredScopes}var PLUGIN=({proxy:{url:"/proxy"},envVariables:{yodaLink:"https://api.stage.yaas.io/hybris/yoda/v1",oauthService:"https://api.stage.yaas.io/hybris/oauth2/v1",accountService:"https://api.stage.yaas.io/hybris/account/v1/",marketplaceService:"https://api.stage.yaas.io/hybris/marketplace/v3",clientId:"4lfyAwV3zeskWEIzoIMxohRMVYd0YFXI",url:"http://127.0.0.1:3000/auth.html",loginCssUrl:"https://devportal.stage.yaas.io/styles/auth-iframe.css"},customLocation:{path:"./apinotebooks",devportalUrl:"http://localhost:9778/apinotebooks/",mode:"external"}}||{}).envVariables;if(PLUGIN){var USER_LOGIN,IDTOKEN,RESIZE_EVENT=new CustomEvent("resizeNeeded"),OAUTH_SERVICE_URL=PLUGIN.oauthService,ACCOUNT_SERVICE_URL=PLUGIN.accountService,CLIENT_ID=PLUGIN.clientId,MARKETPLACE_SERVICE_URL=(PLUGIN.yodaLink,PLUGIN.marketplaceService),REDIR_URL=PLUGIN.url,APP_DATA={},APP_FIRST_FUNC_CALL=!1,PROJ_FIRST_FUNC_CALL=!1,SHOULD_CALL_FOR_NOTENANT_FOR_PROJECT=0,SHOULD_CALL_FOR_NOTENANT_FOR_YODA=!1;$(document).ready(init),window.initApp=init}}},{}]},{},[1])(1)});